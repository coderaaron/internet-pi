# {{ ansible_managed }}
---
{% if domain_name_enable and domain_name and domain_homebridge %}
{# Make sure homebridge and nginx-proxy are in the same network #}
networks:
  front-tier:
    name: internet-monitoring-back-tier
    external: true
{% endif %}

services:
  homebridge:
    container_name: homebridge
    image: homebridge/homebridge:ubuntu
    restart: unless-stopped
    networks:
      - back-tier
    ports:
      - 51205:51205
{% if domain_name_enable and domain_name and domain_homebridge %}
    environment:
      - VIRTUAL_HOST={{ domain_homebridge }}.{{ domain_name }}
      - VIRTUAL_PORT=8581
      - ENABLE_AVAHI=0
{% endif %}
    volumes:
      - homebridge:/homebridge
      - {{ config_dir }}/homebridge/config.json:/homebridge/config.json
volumes:
  homebridge: